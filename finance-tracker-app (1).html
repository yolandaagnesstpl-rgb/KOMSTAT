<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLANNA - Personal Finance Planner</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FFD93D;
            --primary-dark: #FFC107;
            --secondary: #6C63FF;
            --success: #4CAF50;
            --danger: #F44336;
            --warning: #FF9800;
            --dark: #2C3E50;
            --light: #ECF0F1;
            --white: #FFFFFF;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, #FFE57F 100%);
            min-height: 100vh;
        }

        /* Onboarding Screen */
        .onboarding-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .onboarding-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            text-align: center;
        }

        .logo-container {
            margin-bottom: 30px;
        }

        .logo-container img {
            <div class="logo-container">
    <img src="<a href="https://imgbb.com/"><img src="https://i.ibb.co.com/84mM5v6j/logo.jpg" alt="logo" border="0"></a>" alt="PLANNA Logo" style="width: 150px; height: 150px; border-radius: 50%; border: 5px solid var(--primary); object-fit: cover;">
</div>
        }

        .app-title {
            font-size: 2.5em;
            color: var(--secondary);
            font-weight: bold;
            margin: 15px 0;
        }

        .app-subtitle {
            color: #666;
            font-size: 1.1em;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn:hover {
            background: #5952d9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 99, 255, 0.3);
        }

        .btn-primary {
            background: var(--primary);
            color: var(--dark);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-success {
            background: var(--success);
        }

        /* Main App Container */
        .app-container {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .app-header {
            background: white;
            border-radius: 15px;
            padding: 20px 30px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-small {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid var(--primary);
        }

        .user-info h2 {
            color: var(--dark);
            font-size: 1.3em;
        }

        .user-info p {
            color: #666;
            font-size: 0.9em;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .icon-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--light);
            border: none;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
        }

        .icon-btn:hover {
            background: var(--primary);
            transform: scale(1.1);
        }

        /* Tabs Navigation */
        .tabs-container {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .tabs {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 5px;
        }

        .tab-btn {
            padding: 12px 20px;
            background: var(--light);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            white-space: nowrap;
            transition: all 0.3s;
            color: var(--dark);
        }

        .tab-btn:hover {
            background: var(--primary);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: var(--secondary);
            color: white;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: linear-gradient(135deg, var(--secondary) 0%, #8B7FFF 100%);
            padding: 25px;
            border-radius: 15px;
            color: white;
            box-shadow: 0 5px 15px rgba(108, 99, 255, 0.2);
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card.warning {
            background: linear-gradient(135deg, var(--warning) 0%, #FFB74D 100%);
        }

        .card.success {
            background: linear-gradient(135deg, var(--success) 0%, #81C784 100%);
        }

        .card.danger {
            background: linear-gradient(135deg, var(--danger) 0%, #E57373 100%);
        }

        .card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .card .amount {
            font-size: 32px;
            font-weight: bold;
        }

        /* Health Score */
        .health-score-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .score-circle {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            position: relative;
        }

        .score-number {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            font-weight: bold;
        }

        .score-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .score-item {
            background: var(--light);
            padding: 20px;
            border-radius: 10px;
        }

        .score-item h4 {
            color: var(--dark);
            margin-bottom: 10px;
        }

        .score-bar {
            height: 8px;
            background: #ddd;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .score-bar-fill {
            height: 100%;
            background: var(--success);
            transition: width 0.5s;
        }

        /* Toggle */
        .toggle-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .toggle-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .toggle-btn.active {
            border-color: var(--secondary);
            background: var(--secondary);
            color: white;
        }

        /* Transactions */
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: var(--light);
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .transaction-item:hover {
            background: #d5dce0;
            transform: translateX(5px);
        }

        .transaction-info {
            flex: 1;
        }

        .transaction-date {
            font-size: 12px;
            color: #666;
        }

        .transaction-category {
            display: inline-block;
            padding: 4px 12px;
            background: var(--primary);
            color: var(--dark);
            border-radius: 20px;
            font-size: 12px;
            margin-top: 5px;
            font-weight: 600;
        }

        .transaction-amount {
            font-size: 18px;
            font-weight: bold;
            margin-right: 15px;
        }

        .transaction-amount.income {
            color: var(--success);
        }

        .transaction-amount.expense {
            color: var(--danger);
        }

        /* Filters */
        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: var(--light);
            border-radius: 10px;
        }

        /* Budget Progress */
        .budget-item {
            background: var(--light);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .budget-progress {
            width: 100%;
            height: 12px;
            background: #ddd;
            border-radius: 6px;
            overflow: hidden;
            margin: 10px 0;
        }

        .budget-progress-bar {
            height: 100%;
            transition: all 0.3s;
        }

        .budget-progress-bar.safe {
            background: var(--success);
        }

        .budget-progress-bar.warning {
            background: var(--warning);
        }

        .budget-progress-bar.danger {
            background: var(--danger);
        }

        /* Chart Container */
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        /* Insights */
        .insight-card {
            background: white;
            border-left: 4px solid var(--secondary);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .insight-card.success {
            border-left-color: var(--success);
        }

        .insight-card.warning {
            border-left-color: var(--warning);
        }

        .insight-card.danger {
            border-left-color: var(--danger);
        }

        .insight-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .insight-icon {
            font-size: 40px;
        }

        .insight-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--dark);
        }

        .insight-message {
            color: #666;
            line-height: 1.6;
            padding-left: 55px;
        }

        /* Goals */
        .goal-item {
            background: var(--light);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideIn 0.3s;
            max-width: 400px;
        }

        @keyframes slideIn {
            from { transform: translateX(400px); }
            to { transform: translateX(0); }
        }

        .notification.success {
            border-left: 5px solid var(--success);
        }

        .notification.warning {
            border-left: 5px solid var(--warning);
        }

        .notification.danger {
            border-left: 5px solid var(--danger);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-header {
                flex-direction: column;
                gap: 15px;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .transaction-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .chart-wrapper {
                height: 250px;
            }

            .score-circle {
                width: 150px;
                height: 150px;
            }

            .score-number {
                font-size: 36px;
            }
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 13px;
            width: auto;
            display: inline-block;
            margin: 5px;
        }

        .transaction-actions {
            display: flex;
            gap: 5px;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <!-- ONBOARDING SCREEN -->
    <div id="onboardingScreen" class="onboarding-container">
        <div class="onboarding-card">
            <div class="logo-container">
                <img src="https://i.ibb.co/k8Z3qYm/planna-logo.png" alt="PLANNA Logo" style="width: 150px; height: 150px; border-radius: 50%; border: 5px solid var(--primary); object-fit: cover;">
            </div>
            <h1 class="app-title">PLANNA</h1>
            <p class="app-subtitle">Personal Finance Planner<br>Kelola Keuangan dengan Cerdas</p>

            <!-- Login Form -->
            <form id="loginForm">
                <div class="form-group">
                    <label>Email atau No. Telepon</label>
                    <input type="text" id="loginEmail" placeholder="nama@email.com" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="Masukkan password" required>
                </div>
                <button type="submit" class="btn">üîê Masuk ke PLANNA</button>
                <button type="button" class="btn btn-primary" onclick="showRegister()">üìù Daftar Akun Baru</button>
            </form>

            <!-- Register Form (Hidden) -->
            <form id="registerForm" style="display: none;">
                <div class="form-group">
                    <label>Nama Lengkap</label>
                    <input type="text" id="regName" placeholder="Nama Anda" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="regEmail" placeholder="nama@email.com" required>
                </div>
                <div class="form-group">
                    <label>No. Telepon</label>
                    <input type="tel" id="regPhone" placeholder="08123456789" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="regPassword" placeholder="Min. 8 karakter" required>
                </div>
                <div class="form-group">
                    <label>Pemasukan Bulanan</label>
                    <input type="number" id="regIncome" placeholder="Rp 5.000.000" required>
                </div>
                <button type="submit" class="btn">‚ú® Daftar Sekarang</button>
                <button type="button" class="btn btn-primary" onclick="showLogin()">üîô Kembali ke Login</button>
            </form>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="mainApp" class="app-container">
        <!-- Header -->
        <div class="app-header">
            <div class="header-left">
                <div style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); display: flex; align-items: center; justify-content: center; font-size: 24px; border: 3px solid var(--primary);">
                    üí∞
                </div>
                <div class="user-info">
                    <h2 id="userName">Selamat Datang!</h2>
                    <p id="userEmail">user@planna.com</p>
                </div>
            </div>
            <div class="header-actions">
                <button class="icon-btn" onclick="showNotificationCenter()" title="Notifikasi">üîî</button>
                <button class="icon-btn" onclick="showSettings()" title="Pengaturan">‚öôÔ∏è</button>
                <button class="icon-btn" onclick="logout()" title="Keluar">üö™</button>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <div class="tabs-container">
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('dashboard')">üìä Dashboard</button>
                <button class="tab-btn" onclick="switchTab('transactions')">üí≥ Transaksi</button>
                <button class="tab-btn" onclick="switchTab('budget')">üìà Budget</button>
                <button class="tab-btn" onclick="switchTab('goals')">üéØ Target</button>
                <button class="tab-btn" onclick="switchTab('insights')">üß† Insights</button>
                <button class="tab-btn" onclick="switchTab('reports')">üìë Laporan</button>
                <button class="tab-btn" onclick="switchTab('education')">üìö Edukasi</button>
            </div>
        </div>

        <!-- DASHBOARD TAB -->
        <div id="dashboard" class="tab-content active">
            <h2 style="margin-bottom: 20px; color: var(--dark);">üìä Dashboard Keuangan</h2>
            
            <!-- Financial Health Score -->
            <div class="health-score-container">
                <h3 style="margin-bottom: 20px; color: var(--dark);">üíö Financial Health Score</h3>
                <div style="display: grid; grid-template-columns: auto 1fr; gap: 30px; align-items: center;">
                    <div class="score-circle">
                        <canvas id="healthScoreChart"></canvas>
                        <div class="score-number" id="healthScoreNumber">0</div>
                    </div>
                    <div class="score-breakdown" id="scoreBreakdown"></div>
                </div>
            </div>

            <!-- Summary Cards -->
            <div class="summary-cards">
                <div class="card success">
                    <h3>üí∞ Total Pemasukan Bulan Ini</h3>
                    <div class="amount" id="totalIncome">Rp 0</div>
                </div>
                <div class="card danger">
                    <h3>üí∏ Total Pengeluaran Bulan Ini</h3>
                    <div class="amount" id="totalExpense">Rp 0</div>
                </div>
                <div class="card">
                    <h3>üíµ Saldo (Surplus/Defisit)</h3>
                    <div class="amount" id="balance">Rp 0</div>
                </div>
                <div class="card warning">
                    <h3>üìä Saving Rate</h3>
                    <div class="amount" id="savingRate">0%</div>
                </div>
            </div>

            <!-- Charts -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px;">
                <div class="chart-container">
                    <h3 style="margin-bottom: 15px;">üìä Pengeluaran per Kategori</h3>
                    <div class="chart-wrapper">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <h3 style="margin-bottom: 15px;">üìà Trend 6 Bulan Terakhir</h3>
                    <div class="chart-wrapper">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Top Expenses -->
            <div class="chart-container">
                <h3 style="margin-bottom: 15px;">üèÜ Top 5 Pengeluaran Terbesar</h3>
                <div id="topExpenses"></div>
            </div>
        </div>

        <!-- TRANSACTIONS TAB -->
        <div id="transactions" class="tab-content">
            <h2 style="margin-bottom: 20px;">üí≥ Manajemen Transaksi</h2>
            
            <form id="transactionForm" style="background: var(--light); padding: 20px; border-radius: 15px; margin-bottom: 30px;">
                <div class="form-group">
                    <label>Jenis Transaksi</label>
                    <div class="toggle-group">
                        <button type="button" class="toggle-btn active" data-type="income">üí∞ Pemasukan</button>
                        <button type="button" class="toggle-btn" data-type="expense">üí∏ Pengeluaran</button>
                    </div>
                    <input type="hidden" id="transactionType" value="income">
                </div>

                <div class="form-group">
                    <label>Jumlah (Rupiah)</label>
                    <input type="number" id="amount" placeholder="50000" required>
                </div>

                <div class="form-group">
                    <label>Kategori</label>
                    <select id="category" required>
                        <option value="">Pilih Kategori</option>
                        <optgroup label="Pemasukan" id="incomeCategories">
                            <option value="Gaji">Gaji</option>
                            <option value="Bonus">Bonus</option>
                            <option value="Freelance">Freelance</option>
                            <option value="Investasi">Investasi</option>
                            <option value="Lainnya">Lainnya</option>
                        </optgroup>
                        <optgroup label="Pengeluaran" id="expenseCategories" style="display:none;">
                            <option value="Makanan">Makanan</option>
                            <option value="Transport">Transport</option>
                            <option value="Hiburan">Hiburan</option>
                            <option value="Tagihan">Tagihan</option>
                            <option value="Belanja">Belanja</option>
                            <option value="Kesehatan">Kesehatan</option>
                            <option value="Pendidikan">Pendidikan</option>
                            <option value="Lainnya">Lainnya</option>
                        </optgroup>
                    </select>
                </div>

                <div class="form-group">
                    <label>Tanggal</label>
                    <input type="date" id="date" required>
                </div>

                <div class="form-group">
                    <label>Keterangan</label>
                    <input type="text" id="description" placeholder="Contoh: Makan siang">
                </div>

                <div class="form-group">
                    <label>Merchant/Tempat</label>
                    <input type="text" id="merchant" placeholder="Contoh: Restoran ABC">
                </div>

                <button type="submit" class="btn btn-primary">üíæ Simpan Transaksi</button>
            </form>

            <hr style="margin: 30px 0; border: none; border-top: 2px solid var(--light);">

            <h3 style="margin-bottom: 15px;">üîç Filter & Pencarian</h3>
            <div class="filters">
                <div class="form-group" style="margin-bottom: 0;">
                    <label>Jenis</label>
                    <select id="filterType">
                        <option value="all">Semua</option>
                        <option value="income">Pemasukan</option>
                        <option value="expense">Pengeluaran</option>
                    </select>
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>Kategori</label>
                    <select id="filterCategory">
                        <option value="all">Semua Kategori</option>
                    </select>
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>Dari Tanggal</label>
                    <input type="date" id="filterDateFrom">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>Sampai Tanggal</label>
                    <input type="date" id="filterDateTo">
                </div>
            </div>

            <div class="form-group">
                <input type="text" id="searchBox" placeholder="üîç Cari berdasarkan keterangan atau merchant...">
            </div>

            <button onclick="resetFilters()" class="btn" style="background: #666; margin-bottom: 20px;">üîÑ Reset Filter</button>

            <h3 style="margin-bottom: 15px;">üìã Daftar Transaksi</h3>
            <div id="transactionsList"></div>
        </div>

        <!-- BUDGET TAB -->
        <div id="budget" class="tab-content">
            <h2 style="margin-bottom: 20px;">üìà Budget Planning</h2>
            
            <form id="budgetForm" style="background: var(--light); padding: 20px; border-radius: 15px; margin-bottom: 30px;">
                <div class="form-group">
                    <label>Kategori Pengeluaran</label>
                    <select id="budgetCategory" required>
                        <option value="">Pilih Kategori</option>
                        <option value="Makanan">Makanan</option>
                        <option value="Transport">Transport</option>
                        <option value="Hiburan">Hiburan</option>
                        <option value="Tagihan">Tagihan</option>
                        <option value="Belanja">Belanja</option>
                        <option value="Kesehatan">Kesehatan</option>
                        <option value="Pendidikan">Pendidikan</option>
                        <option value="Lainnya">Lainnya</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Budget Bulanan (Rupiah)</label>
                    <input type="number" id="budgetAmount" placeholder="1000000" required>
                </div>

                <button type="submit" class="btn btn-primary">üíæ Set Budget</button>
            </form>

            <h3 style="margin-bottom: 15px;">üìä Budget Tracking</h3>
            <div id="budgetList"></div>

            <div class="summary-cards" style="margin-top: 30px;">
                <div class="card">
                    <h3>Total Budget Bulanan</h3>
                    <div class="amount" id="totalBudget">Rp 0</div>
                </div>
                <div class="card danger">
                    <h3>Total Pengeluaran Aktual</h3>
                    <div class="amount" id="totalActual">Rp 0</div>
                </div>
                <div class="card success">
                    <h3>Selisih</h3>
                    <div class="amount" id="budgetDifference">Rp 0</div>
                </div>
            </div>
        </div>

        <!-- GOALS TAB -->
        <div id="goals" class="tab-content">
            <h2 style="margin-bottom: 20px;">üéØ Target Tabungan</h2>
            
            <form id="goalForm" style="background: var(--light); padding: 20px; border-radius: 15px; margin-bottom: 30px;">
                <div class="form-group">
                    <label>Nama Target</label>
                    <input type="text" id="goalName" placeholder="Contoh: Liburan ke Bali" required>
                </div>

                <div class="form-group">
                    <label>Jumlah Target (Rupiah)</label>
                    <input type="number" id="goalAmount" placeholder="10000000" required>
                </div>

                <div class="form-group">
                    <label>Deadline</label>
                    <input type="date" id="goalDeadline" required>
                </div>

                <div class="form-group">
                    <label>Tabungan Awal (Opsional)</label>
                    <input type="number" id="goalInitial" placeholder="2000000" value="0">
                </div>

                <button type="submit" class="btn btn-primary">üíæ Tambah Target</button>
            </form>

            <h3 style="margin-bottom: 15px;">üìã Daftar Target Tabungan</h3>
            <div id="goalsList"></div>
        </div>

        <!-- INSIGHTS TAB -->
        <div id="insights" class="tab-content">
            <h2 style="margin-bottom: 20px;">üß† Smart Insights</h2>
            <div id="insightsList"></div>
        </div>

        <!-- REPORTS TAB -->
        <div id="reports" class="tab-content">
            <h2 style="margin-bottom: 20px;">üìë Laporan Keuangan</h2>
            
            <div class="filters">
                <div class="form-group" style="margin-bottom: 0;">
                    <label>Periode Laporan</label>
                    <select id="reportPeriod" onchange="generateReport()">
                        <option value="week">Minggu Ini</option>
                        <option value="month" selected>Bulan Ini</option>
                        <option value="year">Tahun Ini</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>Dari Tanggal</label>
                    <input type="date" id="reportDateFrom" onchange="generateReport()">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>Sampai Tanggal</label>
                    <input type="date" id="reportDateTo" onchange="generateReport()">
                </div>
            </div>

            <div class="export-buttons">
                <button class="btn btn-success btn-small" onclick="exportToExcel()">üìä Export Excel</button>
                <button class="btn btn-small" onclick="exportToPDF()">üìÑ Export PDF</button>
                <button class="btn btn-small" style="background: #666;" onclick="printReport()">üñ®Ô∏è Print</button>
            </div>

            <div id="reportContent">
                <div class="summary-cards">
                    <div class="card success">
                        <h3>Total Pemasukan</h3>
                        <div class="amount" id="reportIncome">Rp 0</div>
                    </div>
                    <div class="card danger">
                        <h3>Total Pengeluaran</h3>
                        <div class="amount" id="reportExpense">Rp 0</div>
                    </div>
                    <div class="card">
                        <h3>Net Cash Flow</h3>
                        <div class="amount" id="reportBalance">Rp 0</div>
                    </div>
                    <div class="card warning">
                        <h3>Jumlah Transaksi</h3>
                        <div class="amount" id="reportCount">0</div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3 style="margin-bottom: 15px;">üìä Spending Patterns</h3>
                    <div id="reportCategoryBreakdown"></div>
                </div>

                <div class="chart-container">
                    <h3 style="margin-bottom: 15px;">üìã Detail Transaksi</h3>
                    <div id="reportTransactionsList"></div>
                </div>
            </div>
        </div>

        <!-- EDUCATION TAB -->
        <div id="education" class="tab-content">
            <h2 style="margin-bottom: 20px;">üìö Literasi Keuangan</h2>
            
            <div class="summary-cards">
                <div class="card" style="cursor: pointer;" onclick="showCalculator('emergency')">
                    <h3>üßÆ Kalkulator Dana Darurat</h3>
                    <p>Hitung kebutuhan dana darurat Anda</p>
                </div>
                <div class="card" style="cursor: pointer;" onclick="showCalculator('loan')">
                    <h3>üí≥ Kalkulator Pinjaman</h3>
                    <p>Hitung cicilan & total bunga</p>
                </div>
                <div class="card" style="cursor: pointer;" onclick="showCalculator('investment')">
                    <h3>üìà Kalkulator Investasi</h3>
                    <p>Proyeksi hasil investasi</p>
                </div>
            </div>

            <div class="chart-container">
                <h3 style="margin-bottom: 20px;">üí° Tips Keuangan</h3>
                <div id="educationTips">
                    <div class="insight-card success">
                        <div class="insight-header">
                            <div class="insight-icon">üí∞</div>
                            <div>
                                <div class="insight-title">Aturan 50/30/20</div>
                                <div class="insight-message">
                                    Alokasikan 50% untuk kebutuhan, 30% untuk keinginan, dan 20% untuk tabungan & investasi.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="insight-card">
                        <div class="insight-header">
                            <div class="insight-icon">üè¶</div>
                            <div>
                                <div class="insight-title">Dana Darurat Penting!</div>
                                <div class="insight-message">
                                    Siapkan dana darurat minimal 3-6x pengeluaran bulanan untuk menghadapi situasi tak terduga.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="insight-card warning">
                        <div class="insight-header">
                            <div class="insight-icon">‚ö†Ô∏è</div>
                            <div>
                                <div class="insight-title">Hindari Pinjaman Online</div>
                                <div class="insight-message">
                                    Bunga pinjol bisa mencapai 0.8% per hari atau 292% per tahun! Sangat berbahaya untuk keuangan.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="insight-card success">
                        <div class="insight-header">
                            <div class="insight-icon">üìä</div>
                            <div>
                                <div class="insight-title">Mulai Investasi Sejak Dini</div>
                                <div class="insight-message">
                                    Dengan compound interest, Rp 100.000/bulan di return 10%/tahun = Rp 22 juta dalam 10 tahun!
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let currentUser = null;
        let transactions = [];
        let budgets = {};
        let goals = [];
        let currentTransactionType = 'income';
        let categoryChart = null;
        let trendChart = null;
        let healthChart = null;

        // Initialize
        function init() {
            loadData();
            const user = localStorage.getItem('plannaUser');
            if (user) {
                currentUser = JSON.parse(user);
                showMainApp();
            }
        }

        // Login
       // Login
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            // Get registered users from localStorage
            const registeredUsers = JSON.parse(localStorage.getItem('plannaRegisteredUsers') || '[]');
            
            // Find user with matching email and password
            const user = registeredUsers.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = {
                    name: user.name,
                    email: user.email,
                    phone: user.phone,
                    monthlyIncome: user.monthlyIncome
                };
                localStorage.setItem('plannaUser', JSON.stringify(currentUser));
                showNotification('Login berhasil! Selamat datang di PLANNA', 'success');
                showMainApp();
            } else {
                showNotification('‚ùå Email atau password salah! Silakan coba lagi atau daftar akun baru.', 'danger');
            }
        });

        // Register
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const phone = document.getElementById('regPhone').value;
            const password = document.getElementById('regPassword').value;
            const income = document.getElementById('regIncome').value;

            // Validate password length
            if (password.length < 8) {
                showNotification('‚ùå Password minimal 8 karakter!', 'danger');
                return;
            }

            // Get existing registered users
            const registeredUsers = JSON.parse(localStorage.getItem('plannaRegisteredUsers') || '[]');
            
            // Check if email already exists
            if (registeredUsers.some(u => u.email === email)) {
                showNotification('‚ùå Email sudah terdaftar! Silakan login atau gunakan email lain.', 'danger');
                return;
            }

            // Add new user to registered users
            const newUser = { name, email, phone, password, monthlyIncome: income };
            registeredUsers.push(newUser);
            localStorage.setItem('plannaRegisteredUsers', JSON.stringify(registeredUsers));

            // Set as current user
            currentUser = { name, email, phone, monthlyIncome: income };
            localStorage.setItem('plannaUser', JSON.stringify(currentUser));
            
            showNotification('Registrasi berhasil! Selamat datang di PLANNA üéâ', 'success');
            showMainApp();
        });

        // Register
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const phone = document.getElementById('regPhone').value;
            const income = document.getElementById('regIncome').value;

            currentUser = { name, email, phone, monthlyIncome: income };
            localStorage.setItem('plannaUser', JSON.stringify(currentUser));
            
            showNotification('Registrasi berhasil! Selamat datang di PLANNA üéâ', 'success');
            showMainApp();
        });

        function showRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        }

        function showLogin() {
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
        }

        function showMainApp() {
            document.getElementById('onboardingScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            if (currentUser) {
                document.getElementById('userName').textContent = `Halo, ${currentUser.name}! üëã`;
                document.getElementById('userEmail').textContent = currentUser.email;
            }

            setDefaultDate();
            updateAll();
        }

        function logout() {
            if (confirm('Yakin ingin keluar dari PLANNA?')) {
                localStorage.removeItem('plannaUser');
                location.reload();
            }
        }

        function setDefaultDate() {
            document.getElementById('date').valueAsDate = new Date();
            const today = new Date();
            document.getElementById('reportDateTo').valueAsDate = today;
            const weekAgo = new Date(today);
            weekAgo.setDate(weekAgo.getDate() - 7);
            document.getElementById('reportDateFrom').valueAsDate = weekAgo;
        }

        // Toggle Transaction Type
        document.querySelectorAll('.toggle-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentTransactionType = this.dataset.type;
                document.getElementById('transactionType').value = currentTransactionType;
                
                if (currentTransactionType === 'income') {
                    document.getElementById('incomeCategories').style.display = 'block';
                    document.getElementById('expenseCategories').style.display = 'none';
                } else {
                    document.getElementById('incomeCategories').style.display = 'none';
                    document.getElementById('expenseCategories').style.display = 'block';
                }
                document.getElementById('category').value = '';
            });
        });

        // Transaction Form
        document.getElementById('transactionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const transaction = {
                id: Date.now(),
                type: document.getElementById('transactionType').value,
                amount: parseFloat(document.getElementById('amount').value),
                category: document.getElementById('category').value,
                date: document.getElementById('date').value,
                description: document.getElementById('description').value,
                merchant: document.getElementById('merchant').value
            };

            transactions.push(transaction);
            saveData();
            
            showNotification('‚úÖ Transaksi berhasil disimpan!', 'success');
            this.reset();
            setDefaultDate();
            
            updateAll();
            checkBudgetAlerts(transaction);
        });

        // Budget Form
        document.getElementById('budgetForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const category = document.getElementById('budgetCategory').value;
            const amount = parseFloat(document.getElementById('budgetAmount').value);
            
            budgets[category] = amount;
            saveData();
            
            showNotification('‚úÖ Budget berhasil di-set!', 'success');
            this.reset();
            
            updateAll();
        });

        // Goal Form
        document.getElementById('goalForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const goal = {
                id: Date.now(),
                name: document.getElementById('goalName').value,
                targetAmount: parseFloat(document.getElementById('goalAmount').value),
                deadline: document.getElementById('goalDeadline').value,
                currentAmount: parseFloat(document.getElementById('goalInitial').value) || 0,
                createdDate: new Date().toISOString().split('T')[0]
            };

            goals.push(goal);
            saveData();
            
            showNotification('‚úÖ Target tabungan berhasil ditambahkan!', 'success');
            this.reset();
            
            renderGoals();
        });

        // Switch Tabs
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'insights') {
                generateInsights();
            } else if (tabName === 'reports') {
                generateReport();
            } else if (tabName === 'goals') {
                renderGoals();
            }
        }

        function updateAll() {
            updateDashboard();
            renderTransactions();
            renderBudgets();
            renderGoals();
        }

        // Update Dashboard
        function updateDashboard() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();

            const monthTransactions = transactions.filter(t => {
                const tDate = new Date(t.date);
                return tDate.getMonth() === currentMonth && tDate.getFullYear() === currentYear;
            });

            const income = monthTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expense = monthTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const balance = income - expense;
            const savingRate = income > 0 ? ((balance / income) * 100).toFixed(1) : 0;

            document.getElementById('totalIncome').textContent = formatRupiah(income);
            document.getElementById('totalExpense').textContent = formatRupiah(expense);
            document.getElementById('balance').textContent = formatRupiah(balance);
            document.getElementById('savingRate').textContent = savingRate + '%';

            renderHealthScore();
            renderCategoryChart();
            renderTrendChart();
            renderTopExpenses(monthTransactions);
        }

        // Financial Health Score
        function renderHealthScore() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();

            const monthTransactions = transactions.filter(t => {
                const tDate = new Date(t.date);
                return tDate.getMonth() === currentMonth && tDate.getFullYear() === currentYear;
            });

            const income = monthTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expense = monthTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const savingRate = income > 0 ? ((income - expense) / income * 100) : 0;

            // Calculate score components
            let savingRateScore = 0;
            if (savingRate > 30) savingRateScore = 30;
            else if (savingRate >= 20) savingRateScore = 25;
            else if (savingRate >= 10) savingRateScore = 15;
            else savingRateScore = 5;

            let budgetScore = 30;
            let overBudgetCount = 0;
            Object.entries(budgets).forEach(([cat, budget]) => {
                const spent = monthTransactions.filter(t => t.type === 'expense' && t.category === cat)
                    .reduce((sum, t) => sum + t.amount, 0);
                if (spent > budget) overBudgetCount++;
            });
            if (overBudgetCount >= 2) budgetScore = 10;
            else if (overBudgetCount === 1) budgetScore = 20;

            const daysWithTrans = new Set(monthTransactions.map(t => t.date)).size;
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const consistency = (daysWithTrans / daysInMonth) * 100;
            let consistencyScore = 0;
            if (consistency > 80) consistencyScore = 20;
            else if (consistency >= 50) consistencyScore = 15;
            else consistencyScore = 5;

            const hasEmergencyFund = goals.some(g => g.name.toLowerCase().includes('darurat'));
            const emergencyScore = hasEmergencyFund ? 20 : 0;

            const totalScore = savingRateScore + budgetScore + consistencyScore + emergencyScore;

            // Update score display
            document.getElementById('healthScoreNumber').textContent = totalScore;
            document.getElementById('healthScoreNumber').style.color = 
                totalScore >= 90 ? '#4CAF50' :
                totalScore >= 75 ? '#8BC34A' :
                totalScore >= 60 ? '#FF9800' : '#F44336';

            // Render doughnut chart
            const canvas = document.getElementById('healthScoreChart');
            const ctx = canvas.getContext('2d');

            if (healthChart) healthChart.destroy();

            healthChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [totalScore, 100 - totalScore],
                        backgroundColor: [
                            totalScore >= 90 ? '#4CAF50' :
                            totalScore >= 75 ? '#8BC34A' :
                            totalScore >= 60 ? '#FF9800' : '#F44336',
                            '#E0E0E0'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    cutout: '75%',
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    }
                }
            });

            // Breakdown
            const breakdown = document.getElementById('scoreBreakdown');
            breakdown.innerHTML = `
                <div class="score-item">
                    <h4>üí∞ Saving Rate</h4>
                    <div class="score-bar">
                        <div class="score-bar-fill" style="width: ${(savingRateScore/30*100)}%; background: var(--success);"></div>
                    </div>
                    <p>${savingRateScore}/30 poin</p>
                </div>
                <div class="score-item">
                    <h4>üìä Budget Adherence</h4>
                    <div class="score-bar">
                        <div class="score-bar-fill" style="width: ${(budgetScore/30*100)}%; background: var(--warning);"></div>
                    </div>
                    <p>${budgetScore}/30 poin</p>
                </div>
                <div class="score-item">
                    <h4>üìÖ Consistency</h4>
                    <div class="score-bar">
                        <div class="score-bar-fill" style="width: ${(consistencyScore/20*100)}%; background: var(--secondary);"></div>
                    </div>
                    <p>${consistencyScore}/20 poin</p>
                </div>
                <div class="score-item">
                    <h4>üè¶ Emergency Fund</h4>
                    <div class="score-bar">
                        <div class="score-bar-fill" style="width: ${(emergencyScore/20*100)}%; background: var(--danger);"></div>
                    </div>
                    <p>${emergencyScore}/20 poin</p>
                </div>
            `;
        }

        // Render Category Chart
        function renderCategoryChart() {
            const canvas = document.getElementById('categoryChart');
            const ctx = canvas.getContext('2d');

            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();

            const expenseData = {};
            transactions.filter(t => {
                const tDate = new Date(t.date);
                return t.type === 'expense' && tDate.getMonth() === currentMonth && tDate.getFullYear() === currentYear;
            }).forEach(t => {
                expenseData[t.category] = (expenseData[t.category] || 0) + t.amount;
            });

            if (categoryChart) categoryChart.destroy();

            if (Object.keys(expenseData).length === 0) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                return;
            }

            categoryChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(expenseData),
                    datasets: [{
                        data: Object.values(expenseData),
                        backgroundColor: ['#6C63FF', '#FFD93D', '#FF9800', '#4CAF50', '#F44336', '#3F51B5', '#E91E63', '#00BCD4']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = formatRupiah(context.parsed);
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Render Trend Chart
        function renderTrendChart() {
            const canvas = document.getElementById('trendChart');
            const ctx = canvas.getContext('2d');

            const monthlyData = {};
            const today = new Date();

            for (let i = 5; i >= 0; i--) {
                const d = new Date(today.getFullYear(), today.getMonth() - i, 1);
                const key = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
                monthlyData[key] = { 
                    income: 0, 
                    expense: 0, 
                    label: d.toLocaleDateString('id-ID', { month: 'short', year: '2-digit' }) 
                };
            }

            transactions.forEach(t => {
                const tDate = new Date(t.date);
                const key = `${tDate.getFullYear()}-${String(tDate.getMonth() + 1).padStart(2, '0')}`;
                if (monthlyData[key]) {
                    monthlyData[key][t.type] += t.amount;
                }
            });

            if (trendChart) trendChart.destroy();

            trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Object.values(monthlyData).map(d => d.label),
                    datasets: [
                        {
                            label: 'Pemasukan',
                            data: Object.values(monthlyData).map(d => d.income),
                            borderColor: '#4CAF50',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Pengeluaran',
                            data: Object.values(monthlyData).map(d => d.expense),
                            borderColor: '#F44336',
                            backgroundColor: 'rgba(244, 67, 54, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${formatRupiah(context.parsed.y)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'Rp ' + (value / 1000000).toFixed(1) + 'jt';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Render Top Expenses
        function renderTopExpenses(monthTransactions) {
            const expenses = monthTransactions.filter(t => t.type === 'expense')
                .sort((a, b) => b.amount - a.amount).slice(0, 5);

            const container = document.getElementById('topExpenses');
            
            if (expenses.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì≠</div><p>Belum ada pengeluaran</p></div>';
                return;
            }

            container.innerHTML = expenses.map((t, index) => `
                <div class="transaction-item">
                    <div style="font-size: 24px; margin-right: 15px; font-weight: bold;">${index + 1}</div>
                    <div class="transaction-info">
                        <div><strong>${t.description || t.category}</strong></div>
                        <div class="transaction-date">${formatDate(t.date)}</div>
                        <span class="transaction-category">${t.category}</span>
                    </div>
                    <div class="transaction-amount expense">${formatRupiah(t.amount)}</div>
                </div>
            `).join('');
        }

        // Render Transactions
        function renderTransactions() {
            const list = document.getElementById('transactionsList');
            const filterType = document.getElementById('filterType')?.value || 'all';
            const filterCategory = document.getElementById('filterCategory')?.value || 'all';
            const filterDateFrom = document.getElementById('filterDateFrom')?.value;
            const filterDateTo = document.getElementById('filterDateTo')?.value;
            const searchQuery = document.getElementById('searchBox')?.value.toLowerCase() || '';

            let filtered = transactions.filter(t => {
                if (filterType !== 'all' && t.type !== filterType) return false;
                if (filterCategory !== 'all' && t.category !== filterCategory) return false;
                if (filterDateFrom && t.date < filterDateFrom) return false;
                if (filterDateTo && t.date > filterDateTo) return false;
                if (searchQuery && !t.description.toLowerCase().includes(searchQuery) && 
                    !t.merchant.toLowerCase().includes(searchQuery)) return false;
                return true;
            });

            if (filtered.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì≠</div><p>Belum ada transaksi</p></div>';
                return;
            }

            filtered.sort((a, b) => new Date(b.date) - new Date(a.date));

            list.innerHTML = filtered.map(t => `
                <div class="transaction-item">
                    <div class="transaction-info">
                        <div class="transaction-date">${formatDate(t.date)}</div>
                        <div><strong>${t.description || t.category}</strong></div>
                        ${t.merchant ? `<div style="font-size: 12px; color: #666;">üìç ${t.merchant}</div>` : ''}
                        <span class="transaction-category">${t.category}</span>
                    </div>
                    <div class="transaction-amount ${t.type}">${formatRupiah(t.amount)}</div>
                    <div class="transaction-actions">
                        <button class="btn btn-danger btn-small" onclick="deleteTransaction(${t.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');

            updateFilterCategories();
        }

        // Render Budgets
        function renderBudgets() {
            const list = document.getElementById('budgetList');
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();

            if (Object.keys(budgets).length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üí∞</div><p>Belum ada budget</p></div>';
                return;
            }

            let totalBudget = 0;
            let totalActual = 0;

            const budgetItems = Object.entries(budgets).map(([category, budgetAmount]) => {
                const spent = transactions.filter(t => {
                    const tDate = new Date(t.date);
                    return t.type === 'expense' && t.category === category && 
                           tDate.getMonth() === currentMonth && tDate.getFullYear() === currentYear;
                }).reduce((sum, t) => sum + t.amount, 0);

                const percentage = (spent / budgetAmount * 100).toFixed(1);
                const remaining = budgetAmount - spent;
                
                totalBudget += budgetAmount;
                totalActual += spent;

                let progressClass = 'safe';
                if (percentage > 100) progressClass = 'over';
                else if (percentage > 90) progressClass = 'danger';
                else if (percentage > 70) progressClass = 'warning';

                return `
                    <div class="budget-item">
                        <div style="flex: 1;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <strong>${category}</strong>
                                <span>${percentage}%</span>
                            </div>
                            <div class="budget-progress">
                                <div class="budget-progress-bar ${progressClass}" style="width: ${Math.min(percentage, 100)}%"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 14px; margin-top: 5px;">
                                <span>${formatRupiah(spent)} / ${formatRupiah(budgetAmount)}</span>
                                <span style="color: ${remaining >= 0 ? 'var(--success)' : 'var(--danger)'}">
                                    Sisa: ${formatRupiah(Math.abs(remaining))}
                                </span>
                            </div>
                        </div>
                        <button class="btn btn-danger btn-small" onclick="deleteBudget('${category}')">üóëÔ∏è</button>
                    </div>
                `;
            }).join('');

            list.innerHTML = budgetItems;

            document.getElementById('totalBudget').textContent = formatRupiah(totalBudget);
            document.getElementById('totalActual').textContent = formatRupiah(totalActual);
            document.getElementById('budgetDifference').textContent = formatRupiah(totalBudget - totalActual);
        }

        // Render Goals
        function renderGoals() {
            const list = document.getElementById('goalsList');

            if (goals.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üéØ</div><p>Belum ada target tabungan</p></div>';
                return;
            }

            list.innerHTML = goals.map(goal => {
                const progress = (goal.currentAmount / goal.targetAmount * 100).toFixed(1);
                const remaining = goal.targetAmount - goal.currentAmount;
                
                const deadline = new Date(goal.deadline);
                const today = new Date();
                const monthsRemaining = Math.max(0, Math.ceil((deadline - today) / (1000 * 60 * 60 * 24 * 30)));
                const monthlyTarget = monthsRemaining > 0 ? (remaining / monthsRemaining) : remaining;

                let progressClass = progress >= 100 ? 'safe' : progress >= 50 ? 'warning' : 'danger';

                return `
                    <div class="goal-item">
                        <div class="goal-header">
                            <div>
                                <h3 style="margin-bottom: 5px;">${goal.name}</h3>
                                <div style="font-size: 14px; color: #666;">
                                    Deadline: ${formatDate(goal.deadline)} (${monthsRemaining} bulan lagi)
                                </div>
                            </div>
                            <button class="btn btn-danger btn-small" onclick="deleteGoal(${goal.id})">üóëÔ∏è</button>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span><strong>${formatRupiah(goal.currentAmount)}</strong> / ${formatRupiah(goal.targetAmount)}</span>
                                <span style="font-weight: bold;">${progress}%</span>
                            </div>
                            <div class="budget-progress">
                                <div class="budget-progress-bar ${progressClass}" style="width: ${Math.min(progress, 100)}%"></div>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                            <div style="background: white; padding: 15px; border-radius: 10px;">
                                <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Sisa Target</div>
                                <div style="font-size: 18px; font-weight: bold; color: var(--secondary);">${formatRupiah(remaining)}</div>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 10px;">
                                <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Nabung per Bulan</div>
                                <div style="font-size: 18px; font-weight: bold; color: var(--success);">${formatRupiah(monthlyTarget)}</div>
                            </div>
                        </div>

                        <div style="margin-top: 15px;">
                            <input type="number" id="addAmount${goal.id}" placeholder="Tambah tabungan (Rupiah)" style="margin-bottom: 10px;">
                            <button class="btn btn-success btn-small" onclick="addToGoal(${goal.id})">üí∞ Tambah Tabungan</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Add to Goal
        function addToGoal(goalId) {
            const goal = goals.find(g => g.id === goalId);
            const input = document.getElementById('addAmount' + goalId);
            const amount = parseFloat(input.value);

            if (!amount || amount <= 0) {
                showNotification('Masukkan jumlah yang valid!', 'danger');
                return;
            }

            goal.currentAmount += amount;
            saveData();
            
            if (goal.currentAmount >= goal.targetAmount) {
                showNotification(`üéâ Selamat! Target "${goal.name}" tercapai!`, 'success');
            } else {
                showNotification('Tabungan berhasil ditambahkan!', 'success');
            }

            input.value = '';
            renderGoals();
        }

        // Delete Goal
        function deleteGoal(goalId) {
            if (confirm('Yakin ingin menghapus target tabungan ini?')) {
                goals = goals.filter(g => g.id !== goalId);
                saveData();
                showNotification('Target tabungan berhasil dihapus!', 'success');
                renderGoals();
            }
        }

        // Generate Insights
        function generateInsights() {
            const container = document.getElementById('insightsList');
            const insights = [];

            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();

            const monthTransactions = transactions.filter(t => {
                const tDate = new Date(t.date);
                return tDate.getMonth() === currentMonth && tDate.getFullYear() === currentYear;
            });

            const income = monthTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expense = monthTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);

            // Insight 1: Budget Alerts
            Object.entries(budgets).forEach(([category, budgetAmount]) => {
                const spent = monthTransactions.filter(t => t.type === 'expense' && t.category === category)
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const percentage = (spent / budgetAmount * 100).toFixed(1);
                
                if (percentage > 100) {
                    insights.push({
                        type: 'danger',
                        icon: 'üö®',
                        title: `Budget ${category} Terlampaui!`,
                        message: `Anda sudah menghabiskan ${formatRupiah(spent)} dari budget ${formatRupiah(budgetAmount)} (${percentage}%). Over budget ${formatRupiah(spent - budgetAmount)}.`
                    });
                } else if (percentage > 80) {
                    insights.push({
                        type: 'warning',
                        icon: '‚ö†Ô∏è',
                        title: `Budget ${category} Hampir Habis`,
                        message: `Sisa budget: ${formatRupiah(budgetAmount - spent)} (${(100 - percentage).toFixed(1)}% dari total budget).`
                    });
                }
            });

            // Insight 2: Spending Pattern (compare with last 3 months)
            const last3MonthsExpense = [];
            for (let i = 1; i <= 3; i++) {
                const monthAgo = new Date(currentYear, currentMonth - i, 1);
                const exp = transactions.filter(t => {
                    const tDate = new Date(t.date);
                    return t.type === 'expense' && 
                           tDate.getMonth() === monthAgo.getMonth() && 
                           tDate.getFullYear() === monthAgo.getFullYear();
                }).reduce((sum, t) => sum + t.amount, 0);
                last3MonthsExpense.push(exp);
            }

            const avgLast3Months = last3MonthsExpense.reduce((a, b) => a + b, 0) / 3;
            if (avgLast3Months > 0) {
                const change = ((expense - avgLast3Months) / avgLast3Months * 100).toFixed(1);
                if (change > 20) {
                    insights.push({
                        type: 'warning',
                        icon: 'üìà',
                        title: 'Pengeluaran Meningkat',
                        message: `Pengeluaran bulan ini naik ${change}% dari rata-rata 3 bulan terakhir (${formatRupiah(avgLast3Months)}).`
                    });
                } else if (change < -20) {
                    insights.push({
                        type: 'success',
                        icon: 'üìâ',
                        title: 'Pengeluaran Menurun',
                        message: `Selamat! Pengeluaran turun ${Math.abs(change)}% dibanding 3 bulan lalu. Pertahankan!`
                    });
                }
            }

            // Insight 3: Category Analysis
            const expensesByCategory = {};
            monthTransactions.filter(t => t.type === 'expense').forEach(t => {
                expensesByCategory[t.category] = (expensesByCategory[t.category] || 0) + t.amount;
            });

            const topCategory = Object.entries(expensesByCategory).sort((a, b) => b[1] - a[1])[0];
            if (topCategory) {
                const percentage = (topCategory[1] / expense * 100).toFixed(1);
                insights.push({
                    type: 'info',
                    icon: 'üìä',
                    title: 'Kategori Pengeluaran Terbesar',
                    message: `${topCategory[0]} menjadi kategori terboros dengan ${formatRupiah(topCategory[1])} (${percentage}% dari total pengeluaran).`
                });
            }

            // Insight 4: Savings Recommendation
            const savingRate = income > 0 ? ((income - expense) / income * 100).toFixed(1) : 0;
            if (savingRate < 10 && income > 0) {
                const targetSaving = income * 0.2;
                const needToReduce = expense - (income - targetSaving);
                insights.push({
                    type: 'warning',
                    icon: 'üí°',
                    title: 'Saving Rate Rendah',
                    message: `Saving rate Anda hanya ${savingRate}%. Coba kurangi pengeluaran ${formatRupiah(needToReduce)} untuk mencapai target 20%.`
                });
            } else if (savingRate > 20) {
                insights.push({
                    type: 'success',
                    icon: 'üéâ',
                    title: 'Saving Rate Bagus!',
                    message: `Saving rate Anda ${savingRate}% bulan ini. Pertahankan kebiasaan menabung yang baik!`
                });
            }

            // Insight 5: Weekly Pattern
            const weekdayExpense = { 0: 0, 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0 };
            monthTransactions.filter(t => t.type === 'expense').forEach(t => {
                const day = new Date(t.date).getDay();
                weekdayExpense[day] += t.amount;
            });

            const weekendExpense = weekdayExpense[0] + weekdayExpense[6];
            const weekdaysExpense = Object.entries(weekdayExpense).filter(([d]) => d !== '0' && d !== '6')
                .reduce((sum, [, amt]) => sum + amt, 0);

            if (weekendExpense > weekdaysExpense * 0.4) {
                insights.push({
                    type: 'info',
                    icon: 'üìÖ',
                    title: 'Pola Belanja Akhir Pekan',
                    message: `Anda cenderung berbelanja lebih banyak di akhir pekan (${formatRupiah(weekendExpense)}). Pertimbangkan untuk membuat daftar belanja agar lebih terencana.`
                });
            }

            if (insights.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üß†</div><p>Belum cukup data untuk menghasilkan insights</p></div>';
                return;
            }

            container.innerHTML = insights.map(insight => `
                <div class="insight-card ${insight.type}">
                    <div class="insight-header">
                        <div class="insight-icon">${insight.icon}</div>
                        <div style="flex: 1;">
                            <div class="insight-title">${insight.title}</div>
                            <div class="insight-message">${insight.message}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Generate Report
        function generateReport() {
            const period = document.getElementById('reportPeriod').value;
            const dateFrom = document.getElementById('reportDateFrom').value;
            const dateTo = document.getElementById('reportDateTo').value;

            let filtered = transactions;
            const today = new Date();

            if (period === 'week') {
                const weekAgo = new Date(today);
                weekAgo.setDate(weekAgo.getDate() - 7);
                filtered = transactions.filter(t => new Date(t.date) >= weekAgo);
            } else if (period === 'month') {
                filtered = transactions.filter(t => {
                    const tDate = new Date(t.date);
                    return tDate.getMonth() === today.getMonth() && tDate.getFullYear() === today.getFullYear();
                });
            } else if (period === 'year') {
                filtered = transactions.filter(t => new Date(t.date).getFullYear() === today.getFullYear());
            } else if (period === 'custom' && dateFrom && dateTo) {
                filtered = transactions.filter(t => t.date >= dateFrom && t.date <= dateTo);
            }

            const income = filtered.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expense = filtered.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);

            document.getElementById('reportIncome').textContent = formatRupiah(income);
            document.getElementById('reportExpense').textContent = formatRupiah(expense);
            document.getElementById('reportBalance').textContent = formatRupiah(income - expense);
            document.getElementById('reportCount').textContent = filtered.length;

            // Category Breakdown
            const categoryData = {};
            filtered.filter(t => t.type === 'expense').forEach(t => {
                categoryData[t.category] = (categoryData[t.category] || 0) + t.amount;
            });

            const breakdown = document.getElementById('reportCategoryBreakdown');
            if (Object.keys(categoryData).length === 0) {
                breakdown.innerHTML = '<div class="empty-state"><p>Belum ada data</p></div>';
            } else {
                const total = Object.values(categoryData).reduce((a, b) => a + b, 0);
                breakdown.innerHTML = Object.entries(categoryData)
                    .sort((a, b) => b[1] - a[1])
                    .map(([cat, amount]) => {
                        const percentage = ((amount / total) * 100).toFixed(1);
                        return `
                            <div class="budget-item">
                                <div style="flex: 1;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                        <strong>${cat}</strong>
                                        <span>${formatRupiah(amount)} (${percentage}%)</span>
                                    </div>
                                    <div class="budget-progress">
                                        <div class="budget-progress-bar safe" style="width: ${percentage}%"></div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
            }

            // Transaction List
            const transList = document.getElementById('reportTransactionsList');
            if (filtered.length === 0) {
                transList.innerHTML = '<div class="empty-state"><p>Belum ada transaksi</p></div>';
            } else {
                transList.innerHTML = filtered
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .map(t => `
                        <div class="transaction-item">
                            <div class="transaction-info">
                                <div class="transaction-date">${formatDate(t.date)}</div>
                                <div><strong>${t.description || t.category}</strong></div>
                                <span class="transaction-category">${t.category}</span>
                            </div>
                            <div class="transaction-amount ${t.type}">${formatRupiah(t.amount)}</div>
                        </div>
                    `).join('');
            }
        }

        // Export Functions
        function exportToExcel() {
            const data = transactions.map(t => ({
                Tanggal: t.date,
                Jenis: t.type === 'income' ? 'Pemasukan' : 'Pengeluaran',
                Kategori: t.category,
                Jumlah: t.amount,
                Keterangan: t.description,
                Merchant: t.merchant
            }));

            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Transaksi");
            XLSX.writeFile(wb, `PLANNA_Laporan_${new Date().toISOString().split('T')[0]}.xlsx`);
            
            showNotification('‚úÖ File Excel berhasil di-download!', 'success');
        }

        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFontSize(18);
            doc.text('PLANNA - Laporan Keuangan', 20, 20);
            
            doc.setFontSize(12);
            doc.text(`Tanggal: ${new Date().toLocaleDateString('id-ID')}`, 20, 30);
            
            const income = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expense = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            
            doc.text(`Total Pemasukan: ${formatRupiah(income)}`, 20, 40);
            doc.text(`Total Pengeluaran: ${formatRupiah(expense)}`, 20, 50);
            doc.text(`Saldo: ${formatRupiah(income - expense)}`, 20, 60);

            doc.save(`PLANNA_Laporan_${new Date().toISOString().split('T')[0]}.pdf`);
            
            showNotification('‚úÖ File PDF berhasil di-download!', 'success');
        }

        function printReport() {
            window.print();
        }

        // Calculator Functions
        function showCalculator(type) {
            let content = '';
            
            if (type === 'emergency') {
                content = `
                    <h3>üßÆ Kalkulator Dana Darurat</h3>
                    <div class="form-group">
                        <label>Pengeluaran Bulanan</label>
                        <input type="number" id="monthlyExpense" placeholder="5000000">
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="status">
                            <option value="3">Single (3x)</option>
                            <option value="6">Menikah (6x)</option>
                            <option value="9">Punya Anak (9x)</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="calculateEmergency()">Hitung</button>
                    <div id="calcResult" style="margin-top: 20px;"></div>
                `;
            } else if (type === 'loan') {
                content = `
                    <h3>üí≥ Kalkulator Pinjaman</h3>
                    <div class="form-group">
                        <label>Jumlah Pinjaman</label>
                        <input type="number" id="loanAmount" placeholder="10000000">
                    </div>
                    <div class="form-group">
                        <label>Bunga per Tahun (%)</label>
                        <input type="number" id="interest" placeholder="12">
                    </div>
                    <div class="form-group">
                        <label>Tenor (Bulan)</label>
                        <input type="number" id="tenor" placeholder="12">
                    </div>
                    <button class="btn btn-primary" onclick="calculateLoan()">Hitung</button>
                    <div id="calcResult" style="margin-top: 20px;"></div>
                `;
            } else if (type === 'investment') {
                content = `
                    <h3>üìà Kalkulator Investasi</h3>
                    <div class="form-group">
                        <label>Modal Awal</label>
                        <input type="number" id="principal" placeholder="10000000">
                    </div>
                    <div class="form-group">
                        <label>Return per Tahun (%)</label>
                        <input type="number" id="returnRate" placeholder="10">
                    </div>
                    <div class="form-group">
                        <label>Jangka Waktu (Tahun)</label>
                        <input type="number" id="years" placeholder="5">
                    </div>
                    <button class="btn btn-primary" onclick="calculateInvestment()">Hitung</button>
                    <div id="calcResult" style="margin-top: 20px;"></div>
                `;
            }

            showNotification(content, 'info');
        }

        function calculateEmergency() {
            const expense = parseFloat(document.getElementById('monthlyExpense').value);
            const multiplier = parseFloat(document.getElementById('status').value);
            const result = expense * multiplier;
            
            document.getElementById('calcResult').innerHTML = `
                <div class="insight-card success">
                    <h4>Rekomendasi Dana Darurat Anda:</h4>
                    <div style="font-size: 24px; font-weight: bold; color: var(--success); margin: 10px 0;">
                        ${formatRupiah(result)}
                    </div>
                    <p>Siapkan dana darurat sebesar ${multiplier}x pengeluaran bulanan untuk menghadapi situasi tak terduga.</p>
                </div>
            `;
        }

        function calculateLoan() {
            const principal = parseFloat(document.getElementById('loanAmount').value);
            const annualRate = parseFloat(document.getElementById('interest').value) / 100;
            const tenor = parseFloat(document.getElementById('tenor').value);
            
            const monthlyRate = annualRate / 12;
            const payment = (principal * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -tenor));
            const totalPayment = payment * tenor;
            const totalInterest = totalPayment - principal;
            
            document.getElementById('calcResult').innerHTML = `
                <div class="insight-card warning">
                    <h4>Hasil Perhitungan:</h4>
                    <p><strong>Cicilan per Bulan:</strong> ${formatRupiah(payment)}</p>
                    <p><strong>Total Bayar:</strong> ${formatRupiah(totalPayment)}</p>
                    <p><strong>Total Bunga:</strong> ${formatRupiah(totalInterest)}</p>
                </div>
            `;
        }

        function calculateInvestment() {
            const principal = parseFloat(document.getElementById('principal').value);
            const rate = parseFloat(document.getElementById('returnRate').value) / 100;
            const years = parseFloat(document.getElementById('years').value);
            
            const result = principal * Math.pow(1 + rate, years);
            const profit = result - principal;
            
            document.getElementById('calcResult').innerHTML = `
                <div class="insight-card success">
                    <h4>Proyeksi Investasi:</h4>
                    <p><strong>Modal Awal:</strong> ${formatRupiah(principal)}</p>
                    <p><strong>Hasil Akhir:</strong> ${formatRupiah(result)}</p>
                    <p><strong>Keuntungan:</strong> ${formatRupiah(profit)}</p>
                    <p style="color: var(--success); font-weight: bold;">Return: ${((profit/principal)*100).toFixed(2)}%</p>
                </div>
            `;
        }

        // Helper Functions
        function checkBudgetAlerts(transaction) {
            if (transaction.type !== 'expense') return;

            const category = transaction.category;
            if (!budgets[category]) return;

            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();

            const spent = transactions.filter(t => {
                const tDate = new Date(t.date);
                return t.type === 'expense' && t.category === category && 
                       tDate.getMonth() === currentMonth && tDate.getFullYear() === currentYear;
            }).reduce((sum, t) => sum + t.amount, 0);

            const percentage = (spent / budgets[category] * 100).toFixed(1);

            if (percentage >= 100) {
                showNotification(`üö® Budget ${category} sudah terlampaui! (${percentage}%)`, 'danger');
            } else if (percentage >= 80) {
                showNotification(`‚ö†Ô∏è Budget ${category} sudah mencapai ${percentage}%`, 'warning');
            }
        }

        function deleteTransaction(id) {
            if (confirm('Yakin ingin menghapus transaksi ini?')) {
                transactions = transactions.filter(t => t.id !== id);
                saveData();
                showNotification('‚úÖ Transaksi berhasil dihapus!', 'success');
                updateAll();
            }
        }

        function deleteBudget(category) {
            if (confirm(`Yakin ingin menghapus budget untuk ${category}?`)) {
                delete budgets[category];
                saveData();
                showNotification('‚úÖ Budget berhasil dihapus!', 'success');
                updateAll();
            }
        }

        function updateFilterCategories() {
            const select = document.getElementById('filterCategory');
            const categories = [...new Set(transactions.map(t => t.category))];
            
            select.innerHTML = '<option value="all">Semua Kategori</option>' +
                categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
        }

        function resetFilters() {
            document.getElementById('filterType').value = 'all';
            document.getElementById('filterCategory').value = 'all';
            document.getElementById('filterDateFrom').value = '';
            document.getElementById('filterDateTo').value = '';
            document.getElementById('searchBox').value = '';
            renderTransactions();
        }

        function showNotificationCenter() {
            showNotification('üîî Fitur Notification Center akan segera hadir!', 'info');
        }

        function showSettings() {
            showNotification('‚öôÔ∏è Fitur Settings akan segera hadir!', 'info');
        }

        // Event Listeners
        document.getElementById('filterType')?.addEventListener('change', renderTransactions);
        document.getElementById('filterCategory')?.addEventListener('change', renderTransactions);
        document.getElementById('filterDateFrom')?.addEventListener('change', renderTransactions);
        document.getElementById('filterDateTo')?.addEventListener('change', renderTransactions);
        document.getElementById('searchBox')?.addEventListener('input', renderTransactions);

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="font-weight: 600; margin-bottom: 5px;">
                    ${type === 'success' ? '‚úÖ Berhasil' : type === 'warning' ? '‚ö†Ô∏è Perhatian' : type === 'danger' ? '‚ùå Error' : '‚ÑπÔ∏è Info'}
                </div>
                <div>${message}</div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        function formatRupiah(number) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(number);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('id-ID', options);
        }

        function saveData() {
            const data = {
                transactions: transactions,
                budgets: budgets,
                goals: goals
            };
            localStorage.setItem('plannaData', JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem('plannaData');
            if (saved) {
                const data = JSON.parse(saved);
                transactions = data.transactions || [];
                budgets = data.budgets || {};
                goals = data.goals || [];
            }
        }

        // Demo Data
        if (transactions.length === 0) {
            const today = new Date();
            
            // Add transactions for last 6 months
            for (let monthOffset = 5; monthOffset >= 0; monthOffset--) {
                const monthDate = new Date(today.getFullYear(), today.getMonth() - monthOffset, 1);
                
                // Income
                transactions.push({
                    id: Date.now() + monthOffset * 1000,
                    type: 'income',
                    amount: 5000000,
                    category: 'Gaji',
                    date: new Date(monthDate.getFullYear(), monthDate.getMonth(), 1).toISOString().split('T')[0],
                    description: 'Gaji Bulanan',
                    merchant: 'Perusahaan ABC'
                });

                // Expenses
                const expenseCategories = [
                    { cat: 'Makanan', amount: 1200000, desc: 'Belanja & makan' },
                    { cat: 'Transport', amount: 400000, desc: 'Bensin & transportasi' },
                    { cat: 'Hiburan', amount: 300000, desc: 'Nonton & hangout' },
                    { cat: 'Belanja', amount: 600000, desc: 'Shopping kebutuhan' },
                    { cat: 'Tagihan', amount: 500000, desc: 'Listrik, air, internet' }
                ];

                expenseCategories.forEach((exp, idx) => {
                    transactions.push({
                        id: Date.now() + monthOffset * 1000 + idx + 1,
                        type: 'expense',
                        amount: exp.amount,
                        category: exp.cat,
                        date: new Date(monthDate.getFullYear(), monthDate.getMonth(), 5 + idx * 3).toISOString().split('T')[0],
                        description: exp.desc,
                        merchant: 'Various'
                    });
                });
            }

            // Current month additional
            transactions.push({
                id: Date.now() + 10001,
                type: 'income',
                amount: 1500000,
                category: 'Freelance',
                date: new Date(today.getFullYear(), today.getMonth(), 15).toISOString().split('T')[0],
                description: 'Project Website Client',
                merchant: 'PT Digital Solution'
            });

            transactions.push({
                id: Date.now() + 10002,
                type: 'expense',
                amount: 350000,
                category: 'Kesehatan',
                date: new Date(today.getFullYear(), today.getMonth(), 18).toISOString().split('T')[0],
                description: 'Medical Check Up',
                merchant: 'Klinik Sehat Sentosa'
            });

            // Budgets
            budgets = {
                'Makanan': 1500000,
                'Transport': 600000,
                'Hiburan': 400000,
                'Belanja': 800000,
                'Tagihan': 600000,
                'Kesehatan': 500000,
                'Pendidikan': 1000000
            };

            // Goals
            const futureDate = new Date(today);
            futureDate.setMonth(futureDate.getMonth() + 6);

            goals.push({
                id: Date.now() + 20001,
                name: 'Liburan ke Bali',
                targetAmount: 10000000,
                currentAmount: 3500000,
                deadline: futureDate.toISOString().split('T')[0],
                createdDate: today.toISOString().split('T')[0]
            });

            const futureDate2 = new Date(today);
            futureDate2.setMonth(futureDate2.getMonth() + 12);

            goals.push({
                id: Date.now() + 20002,
                name: 'Dana Darurat',
                targetAmount: 18000000,
                currentAmount: 6000000,
                deadline: futureDate2.toISOString().split('T')[0],
                createdDate: today.toISOString().split('T')[0]
            });

            const futureDate3 = new Date(today);
            futureDate3.setMonth(futureDate3.getMonth() + 8);

            goals.push({
                id: Date.now() + 20003,
                name: 'Beli Laptop Baru',
                targetAmount: 15000000,
                currentAmount: 8500000,
                deadline: futureDate3.toISOString().split('T')[0],
                createdDate: today.toISOString().split('T')[0]
            });

            saveData();
        }

        // Print styling
        const style = document.createElement('style');
        style.textContent = `
            @media print {
                body {
                    background: white;
                    padding: 20px;
                }
                .tabs-container, .app-header, .btn, .export-buttons, .filters, .transaction-actions {
                    display: none !important;
                }
                .tab-content {
                    display: block !important;
                    box-shadow: none;
                }
                .onboarding-container {
                    display: none !important;
                }
                .app-container {
                    display: block !important;
                }
            }

            @media (max-width: 768px) {
                .score-circle {
                    width: 150px;
                    height: 150px;
                }
                .score-number {
                    font-size: 32px;
                }
                .logo-small {
                    width: 40px;
                    height: 40px;
                }
                .app-title {
                    font-size: 2em;
                }
            }
        `;
        document.head.appendChild(style);

        // Initialize app
        init();
    </script>
</body>
</html>